## <center>汉弘工作交接</center>

[TOC]

### 一、preloader和uboot

#### 1.1 preloader和uboot源代码路径

```c
//preloader和uboot源代码共用路径
/home/hanglory/altera/15.0/embedded/examples/hardware/cv_soc_devkit_ghrd/software/spl_bsp/uboot-socfpga
```

#### 1.2 preloader和uboot配置编译

```c
//首先运行脚本embedded_command_shell.sh进行配置
cd ~/altera/15.0/embedded
./embedded_command_shell.sh    

//清理残留编译结果
cd ~/altera/15.0/embedded/examples/hardware/cv_soc_devkit_ghrd/software/spl_bsp
make clean
    
//编译preloader
make 	
    
//编译uboot
make uboot    
```

​		编译得到的preloader和uboot镜像分别是**.../spl_bsp/preloader-mkpimage.bin**和**.../spl_bsp/uboot-socfpga/u-boot.img**。

#### 1.3 uboot命令烧写镜像

```c
/*
 * primary.secondry同体镜像烧写
 */ 

/* 不覆盖环境变量烧写preloader */
mw.b 0x8000 0xff 0x40000
tftp 0x8000 preloader-mkpimage.bin.primary.secondry
sf update 0x8000 0x00000 0x40000  
/* 覆盖环境变量烧写preloader */
mw.b 0x8000 0xff 0x50000
tftp 0x8000 preloader-mkpimage.bin.primary.secondry
sf update 0x8000 0x00000 0x50000   
    
/* 烧写dtb */
mw.b 0x8000 0xff 0x10000
tftp 0x8000 socfpga_cyclone5_socdk.dtb.primary.secondry
sf update 0x8000 0x50000 0x10000
    
/* 烧写uboot */
mw.b 0x8000 0xff 0x40000
tftp 0x8000 u-boot.img.primary.secondry
sf update 0x8000 0x60000 0x40000    
    
/* 烧写rootfs */
mw.b 0x8000 0xff 0x4000000
tftp 0x8000 rootfs.jffs2.primary.secondry
sf update 0x8000 0x2000000 0x4000000
    

/*
 * primary镜像烧写
 */ 
    
/* 烧写primary uImage */
mw.b 0x8000 0xff 0x600000
tftp 0x8000 uImage.primary
sf update 0x8000 0xa0000 0x600000

/* 烧写primary rbf */
mw.b 0x8000 0xff 0x700000
tftp 0x8000 rbf.primary
sf update 0x8000 0x700000 0x700000

/*
 * secondry镜像烧写
 */ 
    
/* 烧写secondry uImage */
mw.b 0x8000 0xff 0x600000
tftp 0x8000 uImage.secondry
sf update 0x8000 0x10a0000 0x600000

/* 烧写secondry rbf */
mw.b 0x8000 0xff 0x700000
tftp 0x8000 rbf.secondry
sf update 0x8000 0x1700000 0x700000
```

#### 1.4 preloader和uboot修改文件

```c
/* preloader */
start.S				//定义点灯函数
spl.c				//调用点灯函数   
    
/* uboot */    
main.c				//增加升级下载功能
socfpga_common.h	//根据升级下载需要修改环境变量(uboot默认环境变量default_environment)    
hanglory_config.h	//根据升级下载需要增加的头文件
watchdog.h			//补充看门狗函数声明
designware_wdt.c	//增加看门狗函数
time.c				//增加不复位看门狗的延时函数
socfpga_common.c   	//setenv_ethaddr_eeprom读取设置以太网mac地址
```



### 二、linux内核和设备树

#### 2.1 linux内核和设备树源代码路径

```c
//linux内核源代码根目录
/home/hanglory/yezheng/linux-socfpga
    
//设备树源文件socfpga_cyclone5_socdk.dts路径
/home/hanglory/yezheng/linux-socfpga/arch/arm/boot/dts
```

#### 2.2 linux内核和设备树配置编译

```c
//清理残留编译结果
cd ~/yezheng/linux-socfpga
make distclean

//使用保留配置
cp yzconfig .config   
//使用官方配置
make socfpga_defconfig	
make menuconfig

/*
 * 只有进行了以上的配置才能进行下面的编译，内核和设备树编译顺序没有依赖关系
 */    
    
// 编译内核 
make zImage -j12
make LOADADDR=0x8000 uImage -j12 

// 编译设备树 
make socfpga_cyclone5_socdk.dtb -j12
```

​		编译得到的内核和设备树镜像分别是**.../arch/arm/boot/uImage**和**.../arch/arm/boot/dts/socfpga_cyclone5_socdk.dtb**。



### 三、根文件系统

#### 3.1 根文件系统源代码路径

```c
/home/hanglory/yezheng/buildroot-2020.08
```

#### 3.2 根文件系统配置编译

```c
//清理残留编译结果
cd ~/yezheng/buildroot-2020.08
make distclean

//使用保留配置
cp hanglory_defconfig .config
//使用官方配置
make socrates_cyclone5_defconfig	
make menuconfig
    
//编译 
make     
```

​		编译得到的根文件系统镜像是**.../output/images/rootfs.jffs2**。



### 四、print.ko驱动

### 五、gpio.ko驱动

### 六、jtag镜像烧写

### 七、硬件版本测试